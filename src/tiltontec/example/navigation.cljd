(ns tiltontec.example.navigation
  "Port of https://docs.flutter.dev/cookbook/navigation/navigation-basics"
  (:require
    ["package:flutter/material.dart" :as m]
    [tiltontec.util.base
     :refer [trx wtrx dprn dp dpx nowtrx prog1 dprn dp dpx *trx?* *trdeep* def-rmap-slots]]
    [tiltontec.cell.base :as cty] ;; todo eliminate need for macro support (unbound ref)
    [tiltontec.mx-flutter.core :as fx]))

(def second-route
  (fx/scaffold
    {:appBar (m/AppBar :title (m/Text "Second Route"))}
    (fx/center
      (fx/elevated-button
        ;; todo universal mechanism for "on" handlers providing ctx
        {:onPressed (fn [me ctx]
                      (dp :onpreess-back-ctx ctx)
                      (fx/ctx-page-pop ctx))}
        (m/Text "Go back!")))))

(def first-route
  (fx/scaffold
    {:appBar (m/AppBar :title (m/Text "First Route"))}
    (fx/center
      (fx/elevated-button
        {:onPressed (fn [me ctx]
                      (dp :onpreess-ctx ctx)
                      (fx/ctx-page-push ctx second-route))}
        (fx/text "Open route")))))

(defn make-app []
  (fx/material-app
    {:title "Navigation Basics"}
    first-route))